---
title: "Forecast"
output: 
  flexdashboard::flex_dashboard:
    #theme:
    #  bg: '#FFFFFF'
    #  fg: '#2C3E50'
    #  primary: '#18BC9C'
    orientation: rows
    vertical_layout: fill
    
runtime: shiny

---

```{r global, include=FALSE, warning=FALSE, message=FALSE}
# libraries
library(flexdashboard)
library(readr)       
library(tidyverse)    
library(ggridges)      
library(shinydashboardPlus)
library(shiny)
library(dplyr)
library(lubridate)
library(tidyr)
library(padr)
library(shinythemes)
library(rio)
library(shinyjs)
library(forecast)
#library(rstudio:bslib)

# pre-set the bw theme.
theme_set(theme_bw())

df <- structure(list(Date = c("1/1/2010", "1/8/2010", "1/15/2010", 
"1/22/2010", "1/29/2010", "2/5/2010", "2/12/2010", "2/19/2010", 
"2/26/2010", "3/5/2010", "3/12/2010", "3/19/2010", "3/26/2010", 
"4/2/2010", "4/9/2010", "4/16/2010", "4/23/2010", "4/30/2010", 
"5/7/2010", "5/14/2010", "5/21/2010", "5/28/2010", "6/4/2010", 
"6/11/2010", "6/18/2010", "6/25/2010", "7/2/2010", "7/9/2010", 
"7/16/2010", "7/23/2010", "7/30/2010", "8/6/2010", "8/13/2010", 
"8/20/2010", "8/27/2010", "9/3/2010", "9/10/2010", "9/17/2010", 
"9/24/2010", "10/1/2010", "10/8/2010", "10/15/2010", "10/22/2010", 
"10/29/2010", "11/5/2010", "11/12/2010", "11/13/2010", "11/25/2010", 
"12/3/2010", "12/10/2010", "12/17/2010", "12/24/2010", "12/31/2010", 
"1/7/2011", "1/14/2011", "1/21/2011", "1/28/2011", "2/4/2011", 
"2/11/2011", "2/18/2011", "2/25/2011", "3/5/2011", "3/11/2011", 
"3/18/2011", "3/25/2011", "4/1/2011", "4/8/2011", "4/15/2011", 
"4/22/2011", "4/29/2011", "5/6/2011", "5/13/2011", "5/20/2011", 
"5/27/2011", "6/3/2011", "6/10/2011", "6/17/2011", "6/24/2011", 
"7/1/2011", "7/8/2011", "7/15/2011", "7/22/2011", "7/29/2011", 
"8/5/2011", "8/12/2011", "8/19/2011", "8/26/2011", "9/2/2011", 
"9/9/2011", "9/16/2011", "9/23/2011", "9/30/2011", "10/7/2011", 
"10/14/2011", "10/21/2011", "10/28/2011", "11/4/2011", "11/11/2011", 
"11/18/2011", "11/25/2011", "12/2/2011", "12/9/2011", "12/16/2011", 
"12/23/2011", "12/30/2011", "1/6/2012", "1/13/2012", "1/20/2012", 
"1/27/2012", "2/3/2012", "2/10/2012", "2/17/2012", "2/24/2012", 
"3/2/2012", "3/9/2012", "3/16/2012", "3/23/2012", "3/30/2012", 
"4/6/2012", "4/13/2012", "4/20/2012", "4/27/2012", "5/4/2012", 
"5/11/2012", "5/18/2012", "5/25/2012", "6/1/2012", "6/8/2012", 
"6/15/2012", "6/22/2012", "6/29/2012", "7/6/2012", "7/13/2012", 
"7/20/2012", "7/27/2012", "8/3/2012", "8/10/2012", "8/17/2012", 
"8/24/2012", "8/31/2012", "9/7/2012", "9/14/2012", "9/21/2012", 
"9/28/2012", "10/5/2012", "10/12/2012", "10/19/2012", "10/26/2012", 
"11/2/2012", "11/9/2012", "11/16/2012", "11/23/2012", "11/30/2012", 
"12/7/2012", "12/14/2012", "12/21/2012", "12/28/2012", "1/4/2013", 
"1/11/2013", "1/18/2013", "1/25/2013", "2/1/2013", "2/8/2013", 
"2/15/2013", "2/22/2013", "3/1/2013", "3/8/2013", "3/15/2013", 
"3/22/2013", "3/29/2013", "4/5/2013", "4/12/2013", "4/19/2013", 
"4/26/2013", "5/3/2013", "5/10/2013", "5/17/2013", "5/24/2013", 
"5/31/2013", "6/7/2013", "6/14/2013", "6/21/2013", "6/28/2013", 
"7/5/2013", "7/12/2013", "7/19/2013", "7/26/2013", "8/2/2013", 
"8/9/2013", "8/16/2013", "8/23/2013", "8/30/2013", "9/6/2013", 
"9/13/2013", "9/20/2013", "9/27/2013", "10/4/2013", "10/11/2013", 
"10/18/2013", "10/25/2013", "11/1/2013", "11/8/2013", "11/15/2013", 
"11/22/2013", "11/29/2013", "12/6/2013", "12/13/2013", "12/20/2013", 
"12/27/2013", "1/3/2014", "1/10/2014", "1/17/2014", "1/24/2014", 
"1/31/2014", "2/7/2014", "2/14/2014", "2/21/2014", "2/28/2014", 
"3/7/2014", "3/14/2014", "3/21/2014", "3/28/2014", "4/4/2014", 
"4/11/2014", "4/18/2014", "4/25/2014", "5/2/2014", "5/9/2014", 
"5/16/2014", "5/23/2014", "5/30/2014", "6/6/2014", "6/13/2014", 
"6/20/2014", "6/27/2014", "7/4/2014", "7/11/2014", "7/18/2014", 
"7/25/2014", "8/1/2014", "8/8/2014", "8/15/2014", "8/22/2014", 
"8/29/2014", "9/5/2014", "9/12/2014", "9/19/2014", "9/26/2014", 
"10/3/2014", "10/10/2014", "10/17/2014", "10/24/2014", "10/31/2014", 
"11/7/2014", "11/14/2014", "11/21/2014", "11/28/2014", "12/5/2014", 
"12/12/2014", "12/19/2014", "12/26/2014", "1/2/2015", "1/9/2015", 
"1/16/2015", "1/23/2015", "1/30/2015", "2/6/2015", "2/13/2015", 
"2/20/2015", "2/27/2015", "3/6/2015", "3/13/2015", "3/20/2015", 
"3/27/2015", "4/3/2015", "4/10/2015", "4/17/2015", "4/24/2015", 
"5/1/2015", "5/8/2015", "5/15/2015", "5/22/2015", "5/29/2015", 
"6/5/2015", "6/12/2015", "6/19/2015", "6/26/2015", "7/3/2015", 
"7/10/2015", "7/17/2015", "7/24/2015", "7/31/2015", "8/7/2015", 
"8/14/2015", "8/21/2015", "8/28/2015", "9/4/2015", "9/11/2015", 
"9/18/2015", "9/25/2015", "10/2/2015", "10/9/2015", "10/16/2015", 
"10/23/2015", "10/30/2015", "11/6/2015", "11/13/2015", "11/20/2015", 
"11/27/2015", "12/4/2015", "12/11/2015", "12/18/2015", "12/25/2015", 
"1/1/2016", "1/8/2016", "1/15/2016", "1/22/2016", "1/29/2016", 
"2/5/2016", "2/12/2016", "2/19/2016", "2/26/2016", "3/4/2016", 
"3/11/2016", "3/18/2016", "3/25/2016", "4/1/2016", "4/8/2016", 
"4/15/2016", "4/22/2016", "4/29/2016", "5/6/2016", "5/13/2016", 
"5/20/2016", "5/27/2016", "6/3/2016", "6/10/2016", "6/17/2016", 
"6/24/2016", "7/1/2016", "7/8/2016", "7/15/2016", "7/22/2016", 
"7/29/2016", "8/5/2016", "8/12/2016", "8/19/2016", "8/26/2016", 
"9/2/2016", "9/9/2016", "9/16/2016", "9/23/2016", "9/30/2016", 
"10/7/2016", "10/14/2016", "10/21/2016", "10/28/2016", "11/4/2016", 
"11/11/2016", "11/18/2016", "11/25/2016", "12/2/2016", "12/9/2016", 
"12/16/2016", "12/23/2016", "12/30/2016", "1/6/2017", "1/13/2017", 
"1/20/2017", "1/27/2017", "2/3/2017", "2/10/2017", "2/17/2017", 
"2/24/2017", "3/3/2017", "3/10/2017", "3/17/2017", "3/24/2017", 
"3/31/2017", "4/7/2017", "4/14/2017", "4/21/2017", "4/28/2017", 
"5/5/2017", "5/12/2017", "5/19/2017", "5/26/2017", "6/2/2017", 
"6/9/2017", "6/16/2017", "6/23/2017", "6/30/2017", "7/7/2017", 
"7/14/2017", "7/21/2017", "7/28/2017", "8/4/2017", "8/11/2017", 
"8/18/2017", "8/25/2017", "9/1/2017", "9/8/2017", "9/15/2017", 
"9/22/2017", "9/29/2017", "10/6/2017", "10/13/2017", "10/20/2017", 
"10/27/2017", "11/3/2017", "11/10/2017", "11/17/2017", "11/24/2017", 
"12/1/2017", "12/8/2017", "12/15/2017", "12/22/2017", "12/29/2017", 
"1/5/2018", "1/12/2018", "1/19/2018", "1/26/2018", "2/2/2018", 
"2/9/2018", "2/16/2018", "2/23/2018", "3/2/2018", "3/9/2018", 
"3/16/2018", "3/23/2018", "3/30/2018", "4/6/2018", "4/13/2018", 
"4/20/2018", "4/27/2018", "5/4/2018", "5/11/2018", "5/18/2018", 
"5/25/2018", "6/1/2018", "6/8/2018", "6/15/2018", "6/22/2018", 
"6/29/2018", "7/6/2018", "7/13/2018", "7/20/2018", "7/27/2018", 
"8/3/2018", "8/10/2018", "8/17/2018", "8/24/2018", "8/31/2018", 
"9/7/2018", "9/14/2018", "9/21/2018", "9/28/2018", "10/5/2018", 
"10/12/2018", "10/19/2018", "10/26/2018", "11/2/2018", "11/9/2018", 
"11/16/2018", "11/23/2018", "11/30/2018", "12/7/2018", "12/14/2018", 
"12/21/2018", "12/28/2018", "1/4/2019", "1/11/2019", "1/18/2019", 
"1/25/2019", "2/1/2019", "2/8/2019", "2/15/2019", "2/22/2019", 
"3/1/2019", "3/8/2019", "3/15/2019", "3/22/2019", "3/29/2019", 
"4/5/2019", "4/12/2019", "4/19/2019", "4/26/2019", "5/3/2019", 
"5/10/2019", "5/17/2019", "5/24/2019", "5/31/2019", "6/7/2019", 
"6/14/2019", "6/21/2019", "6/28/2019", "7/5/2019", "7/12/2019", 
"7/19/2019", "7/26/2019", "8/2/2019", "8/9/2019", "8/16/2019", 
"8/23/2019", "8/30/2019", "9/6/2019", "9/13/2019", "9/20/2019", 
"9/27/2019", "10/4/2019", "10/11/2019", "10/18/2019", "10/25/2019", 
"11/1/2019", "11/8/2019", "11/15/2019", "11/22/2019", "11/29/2019", 
"12/6/2019", "12/13/2019", "12/20/2019", "12/27/2019", "1/3/2020", 
"1/10/2020", "1/17/2020", "1/24/2020", "1/31/2020", "2/7/2020", 
"2/14/2020", "2/21/2020", "2/28/2020", "3/6/2020", "3/13/2020", 
"3/20/2020", "3/27/2020", "4/3/2020", "4/10/2020", "4/17/2020", 
"4/24/2020", "5/1/2020", "5/8/2020", "5/15/2020", "5/22/2020", 
"5/29/2020", "6/5/2020", "6/12/2020", "6/19/2020", "6/26/2020", 
"7/3/2020", "7/10/2020", "7/17/2020", "7/24/2020", "7/31/2020", 
"8/7/2020", "8/14/2020", "8/21/2020", "8/28/2020", "9/4/2020", 
"9/11/2020", "9/18/2020", "9/25/2020", "10/2/2020", "10/9/2020", 
"10/16/2020", "10/23/2020", "10/30/2020", "11/6/2020", "11/13/2020", 
"11/20/2020", "11/27/2020", "12/4/2020", "12/11/2020", "12/18/2020", 
"12/25/2020", "1/1/2021", "1/8/2021", "1/15/2021", "1/22/2021", 
"1/29/2021", "2/5/2021", "2/12/2021", "2/19/2021", "2/26/2021", 
"3/5/2021", "3/12/2021", "3/19/2021", "3/26/2021", "4/2/2021", 
"4/9/2021", "4/16/2021", "4/23/2021", "4/30/2021"), Var1 = c( 
96.03, 97.16, 96.1, 96.15, 97.73, 99.6, 100.05, 102.89, 107.17, 
106.74, 109.98, 111.53, 116.7, 120.25, 125.07, 126.39, 133.4, 
133.42, 127.23, 128.85, 125.21, 124.9, 126.7, 129.13, 129.13, 
125.48, 124.59, 124.25, 123.41, 124.01, 123.79, 123.45, 123.5, 
121.47, 120.09, 120.53, 121.41, 123.01, 122.14, 123.28, 122.62, 
123.1, 122.79, 122.17, 122.22, 122.16, 121.51, 122, 122.02, 122.2, 
124.24, 124.23, 124.33, 123.98, 122.61, 122.43, 120.87, 119.26, 
118.21, 118.31, 116.49, 113.88, 112.64, 112.68, 112.46, 112.55, 
114.68, 114.24, 115.39, 115.38, 117.54, 117.46, 116.31, 116.36, 
116.07, 114.23, 111.65, 109.76, 109.78, 109.63, 110.43, 107.21, 
104.43, 102.97, 101.4, 101.35, 99.1, 94.82, 92.51, 91.89, 89.25, 
86.7, 87.7, 89.17, 86.99, 85.55, 84.09, 86.31, 87.45, 88.77, 
89.84, 89.41, 90.43, 90.18, 89.91, 89.54, 87.55, 85.65, 84.03, 
83.52, 83.02, 82.52, 83.61, 85.17, 87.4, 89.34, 89.57, 89.86, 
89.99, 90.83, 91.06, 91.31, 92.59, 92.81, 93.72, 93.9, 94.22, 
94.26, 93.77, 93.2, 92.15, 90.96, 89.77, 89.58, 89.18, 89.51, 
89.19, 89.18, 88.63, 89.46, 88.93, 88.48, 86.95, 83.65, 80.7, 
79.76, 79.28, 78.95, 79.02, 79.06, 79.03, 78.8, 79.2, 79.08, 
79.04, 78.35, 78.55, 79.5, 79.73, 80.51, 80.86, 81.07, 81.61, 
82.36, 81.82, 82.2, 83.89, 83.26, 83.62, 83.82, 84.11, 84.47, 
84.04, 83.22, 82.5, 81.89, 81.9, 80.53, 79.27, 79.92, 79.03, 
78.61, 78.2, 77.45, 77.14, 77.47, 77.68, 77.48, 77.04, 76.94, 
77.58, 76.98, 76.91, 76.54, 76.41, 76.14, 76.08, 75.64, 75.4, 
74.47, 74.23, 73.96, 73.09, 73.38, 73.15, 73.31, 71.2, 70.35, 
70.27, 69.84, 69.91, 69.68, 69.22, 69, 68.49, 68.62, 68.6, 67.97, 
67.85, 67.54, 67.44, 67.13, 67.01, 66.75, 66.22, 64.62, 64.88, 
64.91, 67.25, 68.1, 68.45, 68.7, 68.64, 68.46, 68.1, 66.18, 65.26, 
64.53, 63.62, 63.62, 63.83, 63.25, 63.12, 62.74, 62.69, 62.38, 
62.38, 61.92, 61.86, 61.68, 61.32, 61.32, 61.1, 60.89, 60.77, 
60.7, 60.43, 60.47, 60.97, 61.03, 60.81, 60.8, 60.78, 60.35, 
60.26, 60, 59.5, 59.28, 59.43, 59.2, 58.97, 58.95, 58.64, 58.65, 
58.56, 58.55, 58.2, 57.83, 57.74, 57.46, 57.42, 57.46, 57.22, 
57.19, 57.19, 57.12, 57.26, 57.28, 57.32, 56.57, 56.41, 56.86, 
56.78, 56.79, 56.78, 56.82, 57.08, 57, 57.15, 57.39, 57.38, 57.9, 
58.18, 58.67, 58.87, 59.64, 60.89, 61.39, 61.98, 63.2, 63.79, 
64.32, 66.6, 69.18, 70.79, 72.08, 73.94, 76.87, 96.37, 105.77, 
110.23, 102.04, 96.8, 94.5, 89.05, 87.35, 87.51, 87.83, 88.66, 
88.34, 88.79, 89.22, 89.59, 89.33, 88.72, 88.73, 89.29, 88.74, 
88.83, 88.87, 88.45, 89.34, 89.2, 87.74, 84.68, 82.91, 80.82, 
77.84, 76.8, 76.41, 79.33, 81.76, 82.4, 81.65, 80.96, 82.71, 
88.68, 88.61, 91.58, 92.5, 93.01, 94.71, 96.38, 96.12, 97.7, 
97.6, 97.51, 98.06, 96.93, 97.63, 97.38, 97.27, 96.26, 95.16, 
94.52, 94.66, 94.82, 97.51, 97.35, 97.95, 98.64, 99.3, 99.79, 
101.37, 102.5, 102.7, 102.72, 105.32, 102.13, 100.29, 98.32, 
93.95, 92.58, 91.16, 90.96, 90.35, 91.26, 93.6, 94.89, 98.37, 
98.86, 98.92, 101.32, 102.99, 102.79, 102.17, 102.18, 103.92, 
105.78, 105.17, 104.26, 102.55, 100.73, 99.78, 98.35, 97.14, 
97.37, 99.41, 98.98, 98.2, 97.92, 97.69, 97.43, 96.01, 96.08, 
94.59, 92.39, 92.32, 92.78, 93.25, 95.63, 95.46, 95.64, 96.22, 
98.07, 98.26, 98.53, 98.43, 95.41, 95.12, 95.51, 95.99, 95.05, 
94.01, 93.69, 85.16, 87.1, 86.43, 83, 85.02, 85.25, 83.51, 82.43, 
80.73, 78.56, 75.98, 74.52, 73.86, 73.84, 74.6, 74.36, 73.94, 
71.22, 71.05, 69, 68.36, 66.7, 66.74, 67.76, 68.02, 68.51, 68.77, 
69.3, 69.91, 70.19, 70.04, 69.8, 69.2, 69.32, 69.54, 69.31, 69.28, 
69.05, 68.89, 68.42, 68.78, 69.25, 69.75, 68.98, 69.56, 69.77, 
69.88, 69.19, 68.75, 68.13, 67.4, 66.73, 66.52, 65.41, 62.71, 
59.16, 56.98, 55.17, 55.33, 56.37, 56.54, 56.42, 55.48, 54.36, 
53.63, 53.23, 53.01, 53.8, 54.16, 53.68, 53.46, 53.05, 52.88, 
52.33, 51.91, 51.97, 53.63, 55.33, 55.82, 56.53, 57.25, 57.81, 
58.02, 58.11, 58.67, 59.52, 62.68, 67.05, 72.12, 80.35, 85.1, 
83.69, 84.67, 88.34, 90.22, 89.08, 86.22, 86.4, 85.88, 84.35, 
84.66, 84.79, 85.53, 88.02, 90.12, 89.75, 89.83, 90.58, 91), 
Var2 = c(92.08, 93.17, 94.27, 
95.09, 100.88, 103.69, 105.07, 103.8, 101.94, 97.3, 98.74, 
99.74, 100.07, 98.27, 99.18, 99.89, 98.77, 98.46, 99.5, 100.87, 
101.78, 101.86, 101.47, 100.22, 102.29, 101.62, 102.93, 104.65, 
104.72, 103.62, 103.62, 103.42, 102.17, 101.08, 100.62, 100.87, 
101.2, 101.17, 101.34, 104.27, 104.8, 104.72, 103.9, 103.46, 
103.45, 101.18, 100.49, 99.68, 98.26, 97.48, 96.03, 94.79, 
94.22, 94.03, 93.89, 94.32, 94.32, 94.29, 94.07, 94.64, 94.72, 
95.72, 94.51, 93.67, 92.76, 91.6, 91.19, 90.5, 90.82, 91.22, 
91.45, 91.2, 90.91, 89.24, 87.82, 87.56, 85.04, 83.81, 82.21, 
78.62, 75.92, 73.65, 73.29, 72.28, 70.84, 70.3, 70.34, 70.27, 
72.41, 73.29, 72.05, 71.77, 71.32, 71.94, 72.36, 72.16, 72.76, 
72.07, 72.31, 72.51, 72.12, 71.89, 71.93, 73.4, 73.01, 73.27, 
73.82, 74.1, 74.28, 74.45, 74.3, 74.48, 75.48, 75.69, 75.96, 
76.26, 76.45, 76.57, 76.1, 76.38, 74.8, 74.59, 74.99, 73.07, 
73.76, 74.53, 73.56, 73.69, 74.66, 74.68, 74.05, 73.12, 72.93, 
71.96, 70.81, 70.84, 69.88, 69.72, 69.17, 69.81, 69.31, 68.91, 
69.89, 68.76, 68.16, 68.09, 67.81, 67.86, 67.69, 67.8, 67.31, 
66.88, 67.88, 67.98, 68.58, 70.09, 69.85, 70.72, 70.74, 70.69, 
71.12, 70.52, 71.01, 71.71, 70.87, 70.74, 70.44, 69.75, 69.58, 
69.23, 68.73, 68.93, 66.74, 67.28, 67.64, 68.32, 68.55, 68.53, 
69.98, 69.1, 67.6, 67.52, 67.15, 67.09, 66.35, 66.08, 65.8, 
65.13, 63.73, 63.7, 63.14, 63.57, 63.41, 62.88, 63.42, 61.93, 
62.04, 61.8, 60.84, 61.2, 60.7, 59.87, 61.05, 60.64, 60.65, 
61.05, 60.84, 60.36, 60.14, 59.27, 58.54, 58.23, 58.27, 58.44, 
58.31, 59.01, 58.87, 60.05, 60.91, 60.73, 60.62, 60.32, 60.24, 
60.17, 59.49, 59.05, 58, 57.47, 57.21, 57.57, 57.19, 56.68, 
56.28, 56.27, 55.63, 55.62, 55.25, 55.01, 54.48, 53.76, 53.44, 
52.92, 53, 53.11, 52.76, 52.38, 52.33, 51.95, 51.92, 51.84, 
51.58, 51.62, 50.35, 49.65, 49.16, 48.55, 48.87, 48.56, 48.48, 
48.41, 48.36, 47.99, 48, 48.02, 47.65, 47.62, 47.47, 47.18, 
46.87, 46.91, 46.69, 46.66, 46.46, 46.71, 46.79, 46.92, 46.65, 
46.36, 46.26, 46.62, 46.71, 46.69, 46.8, 46.97, 47.19, 47.37, 
47.87, 48.12, 47.93, 47.99, 48.18, 48.47, 48.92, 49.69, 50.33, 
51.02, 52.77, 53.5, 54.34, 55.24, 55.9, 57.77, 58.76, 59.77, 
61.85, 63.34, 65.23, 84.34, 89.67, 93.93, 87.71, 85.92, 83.43, 
73.3, 72.5, 72, 72.87, 72.4, 72.34, 73.92, 73.7, 74.02, 73.94, 
73.33, 73.72, 74.41, 74.1, 74.4, 74.54, 74.74, 75.64, 74.98, 
73.87, 72.2, 71.3, 70.25, 68.01, 67.52, 67.21, 68.62, 70.67, 
72.05, 71.73, 71.34, 71.92, 74, 74.37, 75.2, 75.16, 76.27, 
76.24, 76.62, 76.92, 77.31, 78.77, 79.28, 79.19, 79, 79.41, 
79.19, 78.87, 78.47, 77.71, 77.25, 77.84, 78.09, 79.5, 79.63, 
79.79, 79.99, 81.25, 82, 84.6, 84.69, 86.15, 86.05, 87.35, 
86.29, 84.56, 81.96, 79.73, 77.31, 75.77, 74.55, 73.98, 74.52, 
75.38, 76.27, 77.99, 78.53, 79.14, 80.13, 80.5, 81.11, 81.14, 
81.14, 81.17, 80.46, 79.78, 76.65, 75.16, 73.62, 71.96, 71.33, 
70.68, 70.35, 70.67, 70.36, 70.29, 70.25, 70.34, 70.07, 69.54, 
67.73, 66.9, 65.04, 64.86, 64.73, 65.74, 65.98, 65.55, 65.56, 
65.86, 66.74, 68.29, 68.64, 68.84, 69.68, 70.06, 70.22, 71.01, 
70.98, 69.35, 68.49, 67.18, 67.64, 67.23, 67.29, 67.95, 67.96, 
67.32, 66.58, 65.32, 64.93, 64.08, 63.8, 63.55, 63.43, 63.69, 
63.16, 63, 62.09, 61.45, 60.32, 59.59, 58.45, 58.35, 58.55, 
58.79, 58.77, 58.75, 59.08, 59.74, 60.06, 60.43, 59.97, 59.36, 
59.12, 59.25, 59.41, 59.32, 59.22, 59.17, 58.8, 59.48, 59.94, 
60.4, 59.84, 60.84, 61.05, 61.13, 60.95, 60.44, 59.51, 58.53, 
57.65, 56.51, 56.04, 53.55, 51.07, 49.97, 48.61, 48.7, 51.17, 
51.11, 49.85, 48.03, 46.91, 45.35, 44.17, 45.13, 45.05, 45.57, 
45.56, 45.45, 44.92, 44.24, 43.97, 44.21, 43.99, 44.77, 45.77, 
46.68, 47.07, 48.17, 48.94, 48.86, 49.6, 49.34, 51.59, 54.09, 
57.2, 61.7, 66.58, 71.65, 72.34, 78.16, 82.95, 85.98, 81.86, 
77.95, 74.16, 74.13, 72.06, 70.83, 70.24, 69.34, 71.32, 75.05, 
76.38, 77.66, 81.2, 83.25), Var3 = c( 
NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, 
NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, 
NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, 
NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, 
NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, 
NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, 
NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, 
NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, 
NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, 
NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, 
NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, 
NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, 
NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, 
NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, 
NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, 
NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, 
NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, 
NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, 
NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, 
NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, 
NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, 
NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, 
NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, 
NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, 
NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, 
NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, 
NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, 
NA, NA, NA, NA, NA, NA, NA, 723, 726, 660, 627, 581, 547, 
517, 508, 441, 437, 332, 268, 273, 263, 265, 254, 220, 232, 
258, 242, 284, 270, 297, 319, 326, 322, 330, 337, 335, 356, 
344, 349, 349, 346, 350, 346, 311, 331, 328, 335, 341, 344, 
339, 323, 337, 366, 365, 385, 382, 388, 401, 395, 413, 426, 
451, 450, 452, 473, 498, 513, 519, 518, 520, 510, 480, 484, 
478, 499, 496, 500), Var4 = c(NA, NA, NA, NA, NA, NA, NA, 
NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, 
NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, 
NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, 
NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, 
NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, 
NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, 
NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, 
NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, 
NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, 
NA, NA, 86.95, 87.3, 86.01, 86.13, 85.34, 87.25, 90.1, 91.88, 
93, 91.43, 88.25, 90.75, 89.42, 87.41, 85.82, 85.86, 85.79, 
86.13, 86.89, 88.14, 89.46, 90.12, 87.39, 86.17, 82.06, 80.42, 
79.84, 81.45, 83.47, 85.06, 83.62, 83.3, 81.89, 80.92, 80.5, 
77.21, 73.61, 73.36, 74.01, 72.96, 74.37, 75.66, 76.82, 76.58, 
74.74, 75.26, 75.77, 76.15, 76.26, 76.25, 79.14, 81.29, 82.89, 
83.6, 82.39, 87.88, 85.69, 83.73, 82.8, 84.63, 84.24, 83.25, 
86.87, 85.16, 83.25, 81.86, 82.74, 85.6, 83.52, 82.19, 80.04, 
79.42, 76.28, 72.99, 73.34, 74.76, 76.66, 75.75, 77.6, 77.07, 
77, 75.81, 75.45, 74.69, 74.74, 74.56, 74.8, 73.17, 72.07, 
72.44, 71.58, 72.03, 71.98, 73.44, 76, 76.09, 76.92, 77.79, 
77.28, 77.01, 76.18, 75.67, 74.67, 73.84, 72.69, 72.51, 71.93, 
73.3, 74.18, 72.23, 74.28, 74.83, 75.3, 72.52, 71.91, 70.28, 
69.11, 66.75, 60.71, 55.38, 54.95, 56.96, 58.89, 62.91, 63.38, 
62.37, 63.09, 62.4, 59.52, 59.26, 59.35, 58.51, 60.81, 59.66, 
60.36, 60.31, 58.81, 57.18, 57.69, 57.24, 56.84, 59.03, 59.62, 
59.51, 58.21, 58.3, 58.38, 57.79, 57.67, 56.7, 54.66, 54.46, 
55.2, 53.42, 53.69, 53.25, 51.93, 52.7, 52.02, 52.34, 53.87, 
54.1, 54.42, 54.51, 52.11, 49.71, 47.4, 47.52, 47.68, 48.57, 
48.15, 45.06, 44.67, 45.17, 44.84, 43.42, 42.36, 44.9, 45.36, 
47.29, 46.7, 45.4, 45.12, 44.61, 45.51, 46.88, 46.63, 46.7, 
48.22, 48.54, 49.15, 50.82, 50.87, 50.13, 54.33, 53.95, 57.37, 
58.3, 57.39, 58.16, 61.02, 60.27, 61.32, 58.32, 60.96, 60.65, 
60.39, 64.02, 68.13, 75.85, 74.89, 82, 83.73, 85.91, 90.46, 
86.66, 84.07, 85.96, 85.03, 91.85, 95.63, 91.94, 86.34, 88.75, 
90.78, 88.04, 83.64, 82.25, 80.36, 82.78, 78.15, 74.46, 73.23, 
71.04, 69.87, 77.56, 75.23, 74.85, 74.06, 73.66, 72.45, 74.6, 
77.4, 77.37, 78.99, 78.87, 80.26, 80.35, 83.83, 84.41, 83.04, 
82.48, 83.27, 84.38, 86.28, 87.34, 88.35, 89.36, 92.84, 94.2, 
92.02, 91.99, 90.33, 93.2, 92.55, 94.94, 94.69, 94.14, 92.04, 
91.9, 93.28, 95.94, 95.57, 95.83, 96.2, 95.76, 95.14, 93.91, 
90.5, 84.11, 81.86, 86.61, 80.74, 80.89, 80.93, 78.46, 76.25, 
80.09, 82.18, 81.75, 83.19, 85.47, 88.22, 92.79, 91.38, 94.8, 
95.79, 97.33, 97.26, 96.99, 99.93, 102.71, 101.8, 98.8, 94.56, 
96.51, 99.43, 98.16, 99.56, 100.64, 100.45, 99.38, 101.23, 
101.45, 100.01, 98.93, 100.74, 97.66, 92.71, 88.39, 81.37, 
82.3, 86.07, 88.1, 89.46, 86.18, 84.34, 81.21, 81.88, 79.77, 
79.13, 74.25, 71.47, 72.87, 74.9, 73.64, 70.3, 67.29, 61.74, 
54.62, 60.16, 59.64, 58.82, 58.1, 59.35, 58.2, 55.48, 51.12, 
50.55, 49.65, 47.79, 47.68, 53.54, 59.03, 59.34, 61.55, 58.65, 
55.44, 54.95, 53.43, 48.68, 56.82, 62.25, 62.89, 59.49, 59.82, 
60.94, 60.41, 57.99, 56.22, 56.29, 54.7, 55.72, 57.4, 55.58, 
53.06, 52.73, 53.16, 52.09, 52.81, 51.05, 47.67, 48.35, 48.78, 
49.23, 48.99, 46.1, 47.25, 45.68, 48.03, 50.63, 48.1, 45.64, 
44.61, 41.46, 38.26, 39.33, 38.26, 38.8, 38.27, 45.99, 44.91, 
44.64, 46.82, 50.68, 50.04, 48.73, 49.94, 50.15, 51.45, 49.68, 
47.58, 47.42, 51.78, 51.61, 52.55, 53.32, 57.34, 57.77, 56.17, 
56.39, 54.19, 51.41, 52.28, 53.98, 57.48, 62.02, 64.56, 68.58, 
69.71, 68.99, 65.75, 70.31, 66.44, 67.51, 64.86, 68.52, 64.48, 
65.7, 66.35, 65.96, 69.21, 72.25, 69.9, 68.38, 70.8, 73.92, 
75.79), CovidPeriod = c(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 
1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0))) #, class = "col_spec")
df <- as.data.frame(lapply(df, function(x) x[1:448]))
  
# convert to proper date
df$Date1 <- df$Date
df$Date <- as.Date(df$Date, format="%m/%d/%Y")

Var <- setdiff(names(select_if(df, is.numeric)), c("Date", "CovidPeriod"))


```

Forecasting #{data-icon="fa-signal"}
=======================================================================

## Row {.sidebar data-width=280 data-padding=10}

```{r}
br()
selectInput("Series2", label = "Select Series:", choices = Var, multiple = FALSE, width = "98%")
checkboxInput("covid1", "Exclude covid period?", FALSE)
output$value1 <- renderText({ input$covid1 })
hr()


# Select option for confidence interval
selectInput(inputId = "conf_int", label = "Confidence Interval:",
            choice = c("99%" = "99", "95%" = "95", "80%" = "80"), multiple = FALSE, width = "98%")
hr()

sliderInput("Horiz", "Forecast Horizon:", min = 1, max = 52, value = 13)
sliderInput("HoldOut", "Holdout Period:", value = 52, min = 24, max = 104, step = 4 )
hr()


actionButton(inputId="goButton", "Start forecasting!", class = "btn-primary btn-lg")


df2 <- reactive({
        newdf <- df
        if(input$covid1){ 
            newdf <- filter(df, CovidPeriod != 0)
        }
        newdf
})



```


Row {data-height=160}
-----------------------------------------------------------------------

### KPI1 #{.value-box}

```{r}

renderValueBox({
valueBox(round(0.7457475, digits = 3), icon = "fa-check-square", caption = "Model Accuracy", color = "#95d7ae")
})

```

### KPI2  #{.value-box}

```{r}

renderValueBox({
valueBox(round(0.34535435, digits = 3), icon = "fa-check-square", caption = "Misclassification rate", color = "primary")
})

```

### KPI3 #{.value-box}

```{r}

renderValueBox({
valueBox(round(0.858656, digits = 3), icon = "fa-check-square", caption = "Recall", color = "primary")
})
```

library(lubridate)
library(forecast)
start <- 1
end <- 105
n <- nrow(df)
npred <- 20
var <- 'Var1'
tsdata <- ts(df[,var], start=decimal_date(ymd(df$Date[start])), end=decimal_date(ymd(df$Date[end])), frequency=365/7)
fit <- auto.arima(tsdata) # automatically find best arima parameters
pred <- as.data.frame(forecast(fit, h=npred))
out1 <- df[c('Date',var)][start:end,]
out1$type <- 'train'
out2 <- df[c('Date',var)][(end+1):(end+npred),]
out2$type <- 'holdout'
out <- rbind(out1, out2)
for (col in c('Point Forecast', 'Lo 95', 'Hi 95')) {
  out3 <- out2
  out3[,var] <- pred[col]
  out3$type <- col
  out <- rbind(out, out3)
}
MSE <- mean((out2[,var] - pred[,'Point Forecast'])**2) # mean square error
ggplot(out, aes(Date, Var1, col=type)) + geom_line(lwd=2)


#Row {data-height=850}
#-----------------------------------------------------------------------------

### 

```{r}

# Create reactive Date Column in format YYYY-MM-DD
sliderValues2 <- reactive({
  
  df0 <- df2() %>% mutate(Year = as.integer(year(Date)), 
                          Month = as.integer(month(Date)), 
                          Day = as.integer(day(Date))
                          )
  df0$Date2 <- strftime(paste(df0$Year, df0$Month, df0$Day, sep="-"), "%Y-%m-%d")
  df0 %>% select(Date = "Date2", input$Series2)

  })

# Render data reactively as Table
ARIMA <- eventReactive(input$goButton, {

  if (nrow(sliderValues2())==0)
    return()
  
  sliderValues2()

})


tabsetPanel(type = "tabs",
            tabPanel("ARIMA", icon = icon("area-chart"), renderTable({ARIMA()}), value=1),
            tabPanel("ARIMA2", icon = icon("area-chart"), plotOutput("ARIMA2", width="100%", height="100%"), value=1),
            id = "timeSeriesTabs")
```